<!DOCTYPE html>
<html>

	<head>
		<meta charset="UTF-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
		<meta name="format-detection" content="telephone=no">
		<meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=no">
		<link rel="stylesheet" href="../css/main.css" />
		<title></title>
		<style type="text/css">
			.weui-navbar__item {
				padding: 0;
				color: #dd524d;
			}
			
			.jui-btn {
				padding: 0px 6px;
				border-radius: 5px;
			}
			
			.jui-list-cell {
				background-color: #fff
			}
			
			.jui-list .jui-list-cell.no:not(:last-child):before {
				display: none;
			}
		</style>
	</head>

	<body>
		<div class="weui-tab jui-content">
			<div class="weui-navbar">
				<div class="weui-navbar__item" id="type">
					<span id="name">活动类型</span> 
					<i class="iconfont icon-arrowdown"></i>
					<input type="text" id="column" value="全部" style="opacity: 0;position: absolute;left: 0;width: 100%;height: 100%;" readonly="readonly" />
				</div>
				<div class="weui-navbar__item">
					栏目状态 <i class="iconfont icon-arrowdown"></i>
					<input type="text" id="status" value="全部" style="opacity: 0;position: absolute;left: 0;width: 100%;height: 100%;" readonly="readonly" />
				</div>
				<div class="weui-navbar__item" id="show-prompt">
					搜索<i class="iconfont icon-search"></i>
					<input type="hidden" id="search" value="" />
				</div>
			</div>
			<div class="weui-tab__bd">
				<div class="weui-pull-to-refresh listhead" data-page=-1 data-end=0>
					<div class="weui-pull-to-refresh__layer">
						<div class='weui-pull-to-refresh__arrow'></div>
						<div class='weui-pull-to-refresh__preloader'></div>
						<div class="down">下拉刷新</div>
						<div class="up">释放刷新</div>
						<div class="refresh">正在刷新</div>
					</div>
					<ul class="jui-list noborder" style="background-color: #fafafa;">
					</ul>
					<div class="weui-loadmore doing">
						<i class="weui-loading"></i>
						<span class="weui-loadmore__tips">正在加载</span>
					</div>
				</div>
			</div>
			<img src="../img/add.png" class="newfile f-none" />
		</div>

		<script src="../js/public.js"></script>
		<script src="../js/jquery-weui.min.js"></script>
		<script src="../js/common.js"></script>
		<script src="../js/template.js"></script>
		<script type="text/html" id="list1">
			{{each list as item i}}
			<li class="jui-list-cell f-mb10 no">
				<a href="drhddetail.html" class="jui-nav-right">
					<div style="white-space:normal"><span class="tag">[固定学习日]</span>{{item.title}} {{if item.published=="发布"}}
						<span class="jui-btn jui-btn-red f-keepall">未完成</span> {{else if item.published=="不发布"}}
						<span class="jui-btn jui-btn-yellow f-keepall">已完成</span> {{else}}
						<span class="jui-btn jui-btn-red f-keepall">超时未完成</span> {{/if}}
					</div>
					<p>时间：{{item.date}} ~ {{item.date}}</p>
					<p>地点：各党支部活动场所</p>
					<div class="f-oh ">
						<div class="f-width50 f-fl">已完成支部： <span class="f-green">11</span></div>
						<div class="f-width50 f-fl">未完成支部：<span class="f-orange">10</span></div>
					</div>
				</a>
			</li>
			{{/each}}
		</script>
		<script type="text/html" id="list0">
			{{each list as item i}}
			<li class="jui-list-cell">
				<a href="gzbsdetail.html" class="jui-nav-right">
					<div style="white-space:normal">
						{{item.title}}
						{{if item.published=="发布"}}
						<span class="jui-btn jui-btn-red f-keepall">未完成</span> {{else if item.published=="不发布"}}
						<span class="jui-btn jui-btn-yellow f-keepall">已完成</span>  {{/if}}
					</div>
					<p>发布人：李四 </p>
					<p>发布时间：{{item.date}} </p>
					<div class="f-oh ">
						<div class="f-width50 f-fl">已阅支部： <span class="f-green">11</span></div>
						<div class="f-width50 f-fl">未阅支部：<span class="f-orange">10</span></div>
					</div>
				</a>
			</li>
			{{/each}}
		</script>
		<script type="text/html" id="list2">
			{{each list as item i}}
			<li class="jui-list-cell f-mb10 no">
				<a href="zyhddetail.html" class="jui-nav-right">
					<div style="white-space:normal">孙杨喊你来报名！这项世界级赛事招募志愿者，下周二开始！ {{if item.published=="发布"}}
						<span class="jui-btn jui-btn-green f-keepall">进行中</span> {{else if item.published=="不发布"}}
						<span class="jui-btn jui-btn-yellow f-keepall">已结束</span> {{else}}
						<span class="jui-btn jui-btn-blue f-keepall">未开始</span> {{/if}}
					</div>
					<p>时间：{{item.date}} ~ {{item.date}}</p>
					<p>地点：各党支部活动场所</p>
					<div class="f-oh ">
						<p class="f-width50 f-fl">已报名人数： <span class="f-yellow">4</span>人</p>
						<p class="f-width50 f-fl">发起人：张仪</p>
					</div>
				</a>
			</li>
			{{/each}}
		</script>
		<script type="text/html" id="list3">
			{{each list as item i}}
			<li class="jui-list-cell">
				<a href="hygldetail.html" class="jui-nav-right">
					<div style="white-space:normal">
						2018第一季度组织生活会议记录{{item.title}} {{if item.published=="发布"}}
						<span class="jui-btn jui-btn-green f-keepall">进行中</span> {{else if item.published=="不发布"}}
						<span class="jui-btn jui-btn-yellow f-keepall">已结束</span> {{else}}
						<span class="jui-btn jui-btn-blue f-keepall">未开始</span> {{/if}}
					</div>
					<div class="weui-flex"><p class="weui-flex__item">发布人：{{item.writer}}</p>
						<p class="weui-flex__item">地点：第一会议室</p>
					</div>
					<p>会议时间：{{item.date}}~{{item.date}}</p>
				</a>
			</li>
			{{/each}}
		</script>
		<script type="text/html" id="list4">
			{{each list as item i}}
			<li class="jui-list-cell">
				<a href="zxjydetail.html" class="jui-nav-right">
					<div class="f-nowrap">
						{{if item.published=="发布"}}
						<span class="tag2">[已回复]</span> {{else if item.published=="不发布"}}
						<span class="tag3">[未回复]</span> {{/if}} {{item.title}}
					</div>
					<p>发布人：{{item.writer}} <span class="f-fr">{{item.date}}</span></p>
				</a>
			</li>
			{{/each}}
		</script>
		<script type="text/html" id="list5">
			{{each list as item i}}
			<li class="jui-list-cell">
				<a href="wxydetail.html" class="jui-nav-right">
					<div  style="white-space:normal">
						<span class="tag">[NO.00{{i}}]</span>育才学生需要筹集书本{{item.title}}
						{{if item.published=="发布"}}
						<span class="jui-btn jui-btn-green f-keepall">已认领</span> {{else if item.published=="不发布"}}
						<span class="jui-btn jui-btn-yellow f-keepall">已完成</span> {{else}}
						<span class="jui-btn jui-btn-red f-keepall">未认领</span> {{/if}}
					</div>
					<div class="weui-flex"><p class="weui-flex__item">许愿人：{{item.writer}}</p>
						<p class="weui-flex__item">电话：839139110</p>
					</div>
					<p>发起时间：{{item.date}}</p>
				</a>
			</li>
			{{/each}}
		</script>
		<script type="text/html" id="list6">
			{{each list as item i}}
			<li class="imgitem"> 
				<a href="detail.html" >
				<img src="../img/login-bg.jpg" alt=""/> 
				<div class="tip f-nowrap">{{item.title}}</div>
				</a>
			</li >
			{{/each}}
		</script>
		<script>
			$(function() {
				var title = getQueryString("title");
				var newform = getQueryString("new");
				var mine = getQueryString("mine");
				
				if(judge(title)&&newform) {
					$(".newfile").show();
					$("body").on("click", ".newfile", function() {
						window.location.assign(newurl)
					})
				}
				var pullclass = '.weui-pull-to-refresh';
				var tmplID = '';
				var url2 = 'http://xxk.wg.jyit.org:9125/mobile/zhdj/studyManage/getStudyList.jsp?webColumnId=xin4cu7d3pr';
				var userId = '';
				var newurl = '';
				var items = [];
				var items2 = [];
				if(mine) {
					userId = '&userId=' + window.sessionStorage.getItem("userId");
					$('title').text(getQueryString("title2"))
				} else {
					$('title').text(getQueryString("title"))
				}
				
				switch(title) {
					case '党日活动':
						url2 = 'http://xxk.wg.jyit.org:9125/mobile/zhdj/studyManage/getStudyList.jsp?webColumnId=xin4cu7d3pr' + userId;
						tmplID = 'list1';
						newurl = 'newdrhd.html';
						items = [{
								title: "全部",
								value: "-1",
							}, {
								title: "三会一课",
								value: "001",
							},
							{
								title: "教育培训周",
								value: "002",
							},
							{
								title: "统一活动日",
								value: "003",
							},
							{
								title: "志愿活动",
								value: "004",
							},
							{
								title: "固定学习日",
								value: "005",
							}
						];
						items2 = [{
							title: '全部',
							value: "-1",
						}, {
							title: '未完成',
							value: "1",
						}, {
							title: '超时未完成',
							value: "1",
						}, {
							title: '已完成',
							value: "1",
						}]
						break;
					case '志愿活动':
						url2 = 'http://xxk.wg.jyit.org:9125/mobile/zhdj/studyManage/getStudyList.jsp?webColumnId=xin4cu7d3pr' + userId;
						tmplID = 'list2';
						newurl = 'newzyhd.html';
						$("#type").hide();
						items2 = [{
							title: '全部',
							value: "-1",
						}, {
							title: '未开始',
							value: "1",
						}, {
							title: '进行中',
							value: "1",
						}, {
							title: '已结束',
							value: "1",
						}]
						break;
					case '会议管理':
						url2 = 'http://xxk.wg.jyit.org:9125/mobile/zhdj/studyManage/getStudyList.jsp?webColumnId=xin4cu7d3pr';
						tmplID = 'list3';
						newurl = 'newhy.html';
						$("#type").hide();
						items2 = [{
							title: '全部',
							value: "-1",
						}, {
							title: '未开始',
							value: "1",
						}, {
							title: '进行中',
							value: "1",
						}, {
							title: '已结束',
							value: "1",
						}]
						break;
					case '工作部署':
						url2 = 'http://xxk.wg.jyit.org:9125/mobile/zhdj/studyManage/getStudyList.jsp?webColumnId=xin4cu7d3pr' + userId;
						tmplID = 'list0';
						newurl = 'newgzbs.html';
						$("#type").hide();
						items2 = [{
							title: '全部',
							value: "-1",
						}, {
							title: '未完成',
							value: "1",
						}, {
							title: '已完成',
							value: "1",
						}]
						break;
					case '党建相册':
						url2 = 'http://xxk.wg.jyit.org:9125/mobile/zhdj/studyManage/getStudyList.jsp?webColumnId=xin4cu7d3pr' + userId;
						tmplID = 'list6';
						newurl = 'newnormal.html?title='+title;
						$("#type").hide();
						items2 = [{
							title: '全部',
							value: "-1",
						}, {
							title: '来自基层党组织上传',
							value: "1",
						}, {
							title: '来自发布活动讯息和会议',
							value: "1",
						}]
						break;
					case '咨询建议':
						url2 = 'http://xxk.wg.jyit.org:9125/mobile/zhdj/studyManage/getStudyList.jsp?webColumnId=xin4cu7d3pr';
						tmplID = 'list4';
						newurl = 'newzxjy.html';
						$("#type").hide();
						items2 = [{
							title: '全部',
							value: "-1",
						}, {
							title: '未回复',
							value: "1",
						}, {
							title: '已回复',
							value: "1",
						}]
						break;
					case '微心愿':
						url2 = 'http://xxk.wg.jyit.org:9125/mobile/zhdj/studyManage/getStudyList.jsp?webColumnId=xin4cu7d3pr';
						tmplID = 'list5';
						newurl = 'newwxy.html';
						$("#type").hide();
						items2 = [{
							title: '全部',
							value: "-1",
						}, {
							title: '未认领',
							value: "1",
						}, {
							title: '已认领',
							value: "1",
						},{
							title: '已完成',
							value: "1",
						}
						]
						break;
					
				}
				
				
				upAdown(pullclass, url2, function(result, index) {
					if(mine){
						result["mine"]=1;
					}
					var actDataHtml = template(tmplID, result);
					$(pullclass).eq(index).find("ul").append(actDataHtml);
				})

				$("#column").select({
					title: "请选择所属栏目",
					items: items,
					onClose: function() {
						var para = '&column=' + $("#column").val() + "&status=" + $("#status").val() + "&search=" + $("#search").val();
						$(pullclass).pullToRefresh('triggerPullToRefresh')
						console.log(para);
						$(".weui-mask").remove()
					},
					onOpen: function() {
						$("body").append('<div class="weui-mask weui-mask--visible"></div>')
					},
					onChange: function(d) {},
				});
				$("#status").select({
					title: "请选择状态",
					items: items2,
					onClose: function() {
						var para = '&column=' + $("#column").val() + "&status=" + $("#status").val() + "&search=" + $("#search").val();
						$(pullclass).pullToRefresh('triggerPullToRefresh')
						console.log(para);
						$(".weui-mask").remove();
					},
					onOpen: function() {
						$("body").append('<div class="weui-mask weui-mask--visible"></div>')
					},
					onChange: function(d) {}
				});

				$(document).on("click", "#show-prompt", function() {
					$.prompt({
						text: "请输入关键词",
						title: "搜索",
						onOK: function(text) {
							$("#search").val(text);
							var para = '&column=' + $("#column").val() + "&status=" + $("#column").val() + "&search=" + text;
							$(pullclass).pullToRefresh('triggerPullToRefresh')
							console.log(para);
						},
						onCancel: function() {
							console.log("取消了");
						},
						input: ''
					});
				});
			})
		</script>
	</body>

</html>